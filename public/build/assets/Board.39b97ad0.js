import{_ as z,B as G}from"./AppLayout.8ec9311d.js";import{D as A,I as H}from"./ItemModal.9ebaa974.js";import{I as j}from"./ItemGroupCell.b94df27d.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import{k as u,o as l,d as r,h as R,p as L,f as U,b as i,i as E,B as D,j as m,m as F,x as T,w as f,a as $,q as x,l as V,n as I,g as v,t as g,F as k,e as S,C as Y,D as J,E as Q}from"./app.3ce0088d.js";import{A as W}from"./AutomationModal.0ae81b42.js";import{B as X}from"./BulkSelectionBar.07f169b5.js";import"./ConfirmationModal.60162698.js";import"./Modal.09035abd.js";import"./DangerButton.6c27673a.js";import"./SecondaryButton.9fb1985c.js";import"./DialogModal.7ab1b676.js";import"./Button.2e6d22da.js";import"./index.590f4998.js";const Z={props:{fieldData:{type:Object,required:!0},board:{type:Object,required:!0}},watch:{field:{handler(){this.field={...this.fieldData},this.field.type||this.$set(this.field,"type","text")},immediate:!0}},data(){return{fieldTypes:[{name:"text",icon:"fa fa-align-left",title:"Text"},{name:"date",icon:"far fa-calendar-alt",title:"Date"},{name:"time",icon:"far fa-clock",title:"Time"},{name:"number",icon:"fa fa-hashtag",title:"Number"},{name:"label",icon:"fa fa-tags",title:"Selects"},{name:"person",icon:"fa fa-user-friends",title:"Person"}]}},methods:{addField(){const e={board_id:this.board.id,name:this.field.name||this.field.title||`field_${this.board.fields.length}`,title:this.field.title||this.field.name,type:this.field.type,manual:this.field.manual||!0};let t="POST",s="/api/fields";this.field.id&&(t="put",s+=`/${this.field.id}`),axios({url:s,method:t,data:e}).then(()=>{this.$emit("saved")})},deleteField(){axios({url:`/api/fields/${this.field.id}`,method:"delete"}).then(()=>{this.$emit("saved")})}}},q=e=>(L("data-v-6f74faad"),e=e(),U(),e),ee={key:1},te=q(()=>i("i",{class:"fa fa-plus cursor-not-allowed"},null,-1));function se(e,t,s,n,o,d){return u("el-option"),u("el-select"),u("el-popover"),l(),r("div",ee,[R(e.$slots,"default",{},()=>[te],!0)])}var ie=O(Z,[["render",se],["__scopeId","data-v-6f74faad"]]);const de={components:{ItemGroupCell:j},props:{item:{type:Object,required:!0},index:{type:Number,required:!0},isSelectMode:{type:Boolean,default:!1},selectedItems:{type:Array,default(){return[]}}},methods:{getFieldValue(e,t){const s=e.fields.find(n=>n.field_name==t);return s&&s.value}}},K=e=>(L("data-v-01bd239c"),e=e(),U(),e),oe={class:"item-checkbox selection"},ne=["value"],le={class:"item-checkbox"},ae=K(()=>i("div",{class:"flex items-center"},[i("i",{class:"fa fa-align-justify handle"})],-1)),re={class:"points__container"},ce=K(()=>i("div",{class:"flex justify-center w-5 h-full py-2 text-center rounded-full hover:bg-gray-200"},[i("div",{class:"flex items-center mr-2"},[i("i",{class:"fa fa-ellipsis-v"})])],-1)),me=v("Edit"),ue=v("Delete"),fe=["href"],_e=v(" Link by id "),he=["href"],pe=v(" Link by Subject ");function ve(e,t,s,n,o,d){const h=u("item-group-cell"),p=u("el-dropdown-item"),y=u("el-dropdown-menu"),w=u("el-dropdown");return l(),r("div",{class:I("item-false bg-gray-200 border-2 border-white flex"),key:`item-false__title-${s.item.id}`},[i("div",oe,[E(i("input",{type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=_=>s.item.selected=_),value:s.item.id},null,8,ne),[[D,s.item.selected]])]),i("div",le,[E(i("input",{type:"checkbox",class:"checkbox-done",name:"",id:"","onUpdate:modelValue":t[1]||(t[1]=_=>s.item.done=_),onChange:t[2]||(t[2]=_=>e.emit("saved",s.item,"done",s.item.done))},null,544),[[D,s.item.done]])]),ae,m(h,{class:"flex items-center","field-name":"title","select-mode":s.isSelectMode,index:s.index,item:s.item,onSelected:t[3]||(t[3]=_=>e.$emit("selected",_)),onSaved:t[4]||(t[4]=_=>e.$emit("saved",s.item,"title",_))},null,8,["select-mode","index","item"]),i("div",re,[E(i("input",{type:"text",title:"Estimation Points",class:"points__input","onUpdate:modelValue":t[5]||(t[5]=_=>s.item.points=_),placeholder:"0",onKeydown:t[6]||(t[6]=T(_=>e.$emit("saved",s.item,"points",s.item.points),["enter"])),onBlur:t[7]||(t[7]=_=>e.$emit("saved",s.item,"points",s.item.points))},null,544),[[F,s.item.points]])]),m(w,{trigger:"click",onCommand:t[8]||(t[8]=_=>e.$emit("command",s.item,_)),onClick:t[9]||(t[9]=V(()=>{},["prevent"]))},{default:f(()=>[ce,m(y,{slot:"dropdown"},{default:f(()=>[m(p,{command:"edit",icon:"fa fa-edit"},{default:f(()=>[me]),_:1}),m(p,{command:"delete",icon:"fa fa-trash"},{default:f(()=>[ue]),_:1}),i("a",{href:d.getFieldValue(s.item,"url_id"),target:"_blank",rel:"noopener noreferrer"},[d.getFieldValue(s.item,"url_id")?(l(),$(p,{key:0,command:"go",icon:"fa fa-external-link-alt"},{default:f(()=>[_e]),_:1})):x("",!0)],8,fe),i("a",{href:d.getFieldValue(s.item,"url_subject"),target:"_blank",rel:"noopener noreferrer"},[d.getFieldValue(s.item,"url_subject")?(l(),$(p,{key:0,command:"go",icon:"fa fa-external-link-alt"},{default:f(()=>[pe]),_:1})):x("",!0)],8,he)]),_:1})]),_:1})])}var be=O(de,[["render",ve],["__scopeId","data-v-01bd239c"]]);const ge={components:{ItemGroupCell:j,Draggable:A,FieldPopover:ie,ItemGroupTitle:be},props:{createMode:{type:Boolean},stage:{type:Object},board:{type:Object},selectedItems:{type:Array,default(){return[]}},items:{type:Array,default(){return[]}}},data(){return{newItem:{},newField:{},isSelectMode:!1,isEditMode:!1,isExpanded:!0,isItemModalOpen:!1,isLoaded:!1}},watch:{tableSize:{handler(){document.documentElement.style.setProperty("--board-column-size",this.tableSize)},deep:!0,immediate:!0},selectedItems(){this.$emit("selected-items-updated",this.selectedItems)}},computed:{visibleFields(){return this.board.fields.filter(e=>!e.hide)},tableSize(){return this.visibleFields.length}},methods:{getBg(e,t,s){const n=t.fields&&t.fields.find(d=>d.field_name==s),o=n?n.value:t[s];if(o&&e.rules){const d=e.rules.find(h=>h.name=="bg");if(d){const h=d.options||e[d.reference],p=h&&h.find(y=>{const w=y.name||y.value;return o.toLowerCase()==w.toLowerCase()});return p?"bg-"+(p.result||p.color)+"-300":""}}return"bg-gray-200"},toggleExpand(){this.isExpanded=!this.isExpanded},toggleEditMode(){this.isEditMode=!this.isEditMode,this.$nextTick(()=>{this.$refs.input&&this.$refs.input.focus()})},addItem(e,t){const s=Math.max(...this.stage.items.map(n=>n.order));this.newItem.board_id=e.board_id,this.newItem.stage_id=e.id,this.newItem.fields=this.board.fields.map(n=>({field_id:n.id,field_name:n.name,value:this.newItem[n.name]})),this.newItem.order=s+1,this.$emit("saved",{...this.newItem},t),this.newItem={}},handleSelect(){},onFieldAdded(){this.newField={},this.$inertia.reload({preserveScroll:!0})},saveChanges(e,t,s){e[t]=s,e.fields=this.board.fields.map(n=>({field_id:n.id,field_name:n.name,value:e[n.name]})),this.$emit("saved",{...e})},saveStage(e){e.name=this.$refs.input.value,this.isEditMode=!1,this.$emit("stage-updated",{...e})},saveReorder(){this.stage.items.forEach(async(e,t)=>{e.order=t,this.$emit("saved",{...e},!1)}),this.$inertia.reload({preserveScroll:!0})},handleBoardCommands(e){switch(e){case"delete":this.$emit("board-deleted",item);break;case"edit":this.toggleEditMode();break;case"selection":this.isSelectMode=!this.isSelectMode;break}},handleCommand(e,t){switch(t){case"delete":this.$emit("item-deleted",e);break;case"edit":this.$emit("open-item",e);break}},toggleSelection(){this.stage.items.forEach(e=>{this.$set(e,"selected",this.stage.selected)})}}},ye=["data-table-size"],we={class:"ic-list__title"},xe={class:"item-false__header sticky_header"},ke={class:"header-cell item-group-row__header"},Se={class:"item-group__selector"},Ie={key:0,class:"font-bold handle"},$e={key:1},Ce=["value"],Ee={key:2},Oe=i("div",{class:"flex justify-center w-5 h-full py-2 text-center rounded-full hover:bg-gray-200"},[i("div",{class:"flex items-center justify-center"},[i("i",{class:"fa fa-ellipsis-v"})])],-1),Me=v("Edit"),Te=v("Delete"),Ve=v("Select Mode"),De=i("div",{class:"false-header"},null,-1),Ae={key:0,class:"grid"},je={key:0,class:"item-group ic-scroller ic-scroller-slim"},Be={class:"grid py-1 text-left item-group-row sticky_header"},Fe={key:0,class:"font-bold"},Le=i("div",{class:"false-header"},null,-1),Ue={key:1,class:"ic-list__add"},Pe={class:"item-false__header sticky_header"},Ke={class:"item-group-row__header"},Ne=i("i",{class:"fa fa-plus",slot:"reference"},null,-1),ze=i("div",{class:"false-header"},null,-1),Ge={class:"grid bg-red-500"},He={class:"ic-list__footer"},Re={class:"grid grid-cols-10 text-left item-line"},Ye={class:"flex items-center col-span-12 px-0 item-line-cell"};function Je(e,t,s,n,o,d){const h=u("el-dropdown-item"),p=u("el-dropdown-menu"),y=u("el-dropdown"),w=u("item-group-title"),_=u("draggable"),b=u("field-popover"),c=u("item-group-cell");return l(),r("div",{class:"ic-list","data-table-size":d.tableSize},[i("div",{class:I(["ic-list__body",{"not-expanded":!o.isExpanded,loaded:o.isLoaded}])},[i("div",we,[i("div",xe,[i("div",ke,[i("span",{class:"toolbar-buttons",onClick:t[0]||(t[0]=(...a)=>d.toggleExpand&&d.toggleExpand(...a))},[i("i",{class:I([o.isExpanded?"fa fa-chevron-down":"fa fa-chevron-right"])},null,2)]),i("div",Se,[E(i("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=a=>s.stage.selected=a),onChange:t[2]||(t[2]=a=>d.toggleSelection())},null,544),[[D,s.stage.selected]])]),o.isEditMode?(l(),r("div",$e,[i("input",{value:s.stage.name,type:"text",ref:"input",onKeypress:t[3]||(t[3]=T(a=>d.saveStage(s.stage),["enter"])),onBlur:t[4]||(t[4]=a=>d.saveStage(s.stage))},null,40,Ce)])):(l(),r("span",Ie,g(s.stage.title||s.stage.name)+" "+g(o.isSelectMode?"(Selection Mode)":""),1)),o.isExpanded?x("",!0):(l(),r("span",Ee," ("+g(s.items.length)+" items) ",1)),i("i",{class:"mx-2 fa fa-edit",onClick:t[5]||(t[5]=a=>d.toggleEditMode(!0))}),m(y,{trigger:"click",onCommand:d.handleBoardCommands,onClick:t[6]||(t[6]=V(()=>{},["prevent"]))},{default:f(()=>[Oe,m(p,{slot:"dropdown"},{default:f(()=>[m(h,{command:"edit",icon:"fa fa-edit"},{default:f(()=>[Me]),_:1}),m(h,{command:"delete",icon:"fa fa-trash"},{default:f(()=>[Te]),_:1}),m(h,{command:"selection",icon:"fa fa-check"},{default:f(()=>[Ve]),_:1})]),_:1})]),_:1},8,["onCommand"])])]),De,o.isExpanded?(l(),r("div",Ae,[m(_,{modelValue:s.stage.items,"onUpdate:modelValue":t[7]||(t[7]=a=>s.stage.items=a),onEnd:d.saveReorder,handle:".handle",class:"w-full"},{default:f(()=>[(l(!0),r(k,null,S(s.stage.items,(a,C)=>(l(),$(w,{class:"flex bg-gray-200 border-2 border-white item-false",key:`item-false__title-${a.id}`,item:a,index:C,"selected-items":s.selectedItems,"is-select-mode":o.isSelectMode,onSelected:d.handleSelect,onSaved:d.saveChanges,onCommand:d.handleCommand},null,8,["item","index","selected-items","is-select-mode","onSelected","onSaved","onCommand"]))),128))]),_:1},8,["modelValue","onEnd"])])):x("",!0)]),o.isExpanded?(l(),r("div",je,[i("div",Be,[(l(!0),r(k,null,S(d.visibleFields,a=>(l(),r("div",{key:a.name,class:"item-group-row__header"},[o.isExpanded?(l(),r("span",Fe,[m(b,{"field-data":a,board:s.board,onSaved:d.onFieldAdded},{default:f(()=>[v(g(a.title),1)]),_:2},1032,["field-data","board","onSaved"])])):x("",!0)]))),128))]),Le,o.isExpanded?(l(!0),r(k,{key:0},S(s.items,(a,C)=>(l(),r("div",{class:"grid text-left item-group-row h-11",key:`item-${C}`},[(l(!0),r(k,null,S(d.visibleFields,M=>(l(),r("div",{key:M.name,class:I(["text-center border-2 border-white custom-field",[d.getBg(M,a,M.name)]])},[m(c,{"field-name":M.name,field:M,index:C,item:a,onSaved:N=>d.saveChanges(a,M.name,N)},null,8,["field-name","field","index","item","onSaved"])],2))),128))]))),128)):x("",!0)])):x("",!0),o.isExpanded?(l(),r("div",Ue,[i("div",Pe,[i("div",Ke,[m(b,{"field-data":o.newField,board:s.board,onSaved:d.onFieldAdded},{default:f(()=>[Ne]),_:1},8,["field-data","board","onSaved"])])]),ze,i("div",Ge,[(l(!0),r(k,null,S(s.stage.items,a=>(l(),r("div",{class:"item-false",key:`item-false-${a.id}`}))),128))])])):x("",!0)],2),i("div",He,[i("div",Re,[i("div",Ye,[m(c,{class:"flex items-center w-full","field-name":"title","is-title":!0,index:-1,item:o.newItem,"is-new":!0,onSaved:t[8]||(t[8]=a=>o.newItem.title=a),onKeydown:t[9]||(t[9]=T(a=>d.addItem(s.stage),["enter"]))},null,8,["item"])])])])],8,ye)}var Qe=O(ge,[["render",Je]]);const We={props:{kanbanData:{type:Object,required:!0},stages:{type:Array,required:!0},fields:{type:Array,required:!0}},components:{ItemGroupCell:j,Draggable:A},methods:{addItem(e){const t=e.childs[e.childs.length-1],s=Math.max(...e.childs.map(d=>d.order)),n={...e.newTask};n.board_id=t?t.board_id:this.stages[0].board_id,n.stage_id=t?t.stage_id:this.stages[0].id;const o=this.fields.find(d=>d.id==e.attributes.field_id);n.fields=[{field_id:e.attributes.field_id,field_name:o.name,value:e.attributes.name}],n.order=s+1,this.$emit("saved",{...n},!0),e.newTask={}},changeStatus(e,t){if(e.added){let s=e.added.element.fields.find(n=>n.field_id==t.attributes.field_id);s?this.$set(s,"value",t.attributes.name):(s=this.fields.find(n=>n.id==t.attributes.field_id),e.added.element.fields.push({field_id:s.id,field_name:s.name,value:t.attributes.name})),this.$emit("saved",e.added.element)}}}},Xe={class:"flex kanban-container"},Ze={class:"flex items-center justify-between w-full h-12 font-bold capitalize header"},qe={class:"ml-4 text-gray-300"},et=i("div",{class:"flex justify-center w-5 h-full py-2 text-center rounded-full hover:bg-gray-200"},[i("div",{class:"flex items-center mr-2"},[i("i",{class:"fa fa-ellipsis-v"})])],-1),tt=v("Edit"),st=v("Delete"),it={class:"pt-5 pr-4"},dt={class:"checkbox-label"},ot=["onUpdate:modelValue","id","onChange"],nt=i("span",{class:"font-bold"},null,-1);function lt(e,t,s,n,o,d){const h=u("el-dropdown-item"),p=u("el-dropdown-menu"),y=u("el-dropdown"),w=u("draggable"),_=u("item-group-cell");return l(),r("div",Xe,[(l(!0),r(k,null,S(s.kanbanData,(b,c)=>(l(),r("div",{key:c,class:"w-full mx-2"},[i("div",Ze,[i("div",null,[i("span",{class:I(`text-${b.attributes.color}-400`)},g(c),3),i("span",qe,g(b.childs.length),1)]),m(y,{trigger:"click",onClick:t[0]||(t[0]=V(()=>{},["prevent"]))},{default:f(()=>[et,m(p,{slot:"dropdown"},{default:f(()=>[m(h,{command:"edit",icon:"fa fa-edit"},{default:f(()=>[tt]),_:1}),m(h,{command:"delete",icon:"fa fa-trash"},{default:f(()=>[st]),_:1})]),_:1})]),_:1})]),i("div",it,[m(w,{list:b.childs,group:"tasks",onChange:a=>d.changeStatus(a,b)},{default:f(()=>[(l(!0),r(k,null,S(b.childs,a=>(l(),r("div",{key:`task-${a.id}`,class:"task-item"},[i("label",dt,[E(i("input",{"onUpdate:modelValue":C=>a.done=C,id:a.id,class:"checkbox-done",type:"checkbox",name:"",onChange:C=>e.$emit("update-item",a),onClick:t[1]||(t[1]=V(()=>{},["stop"]))},null,40,ot),[[D,a.done]]),nt,i("span",null,g(a.title),1)])]))),128))]),_:2},1032,["list","onChange"]),m(_,{class:"flex items-center w-full","field-name":"title","is-title":!0,index:-1,item:b.newTask,"is-new":!0,onSaved:a=>b.newTask.title=a,onKeydown:T(a=>d.addItem(b),["enter"])},null,8,["item","onSaved","onKeydown"])])]))),128))])}var at=O(We,[["render",lt]]);const rt={props:{kanbanData:{type:Object,required:!0},stages:{type:Array,required:!0},fields:{type:Array,required:!0}},components:{ItemGroupCell:j,Draggable:A},methods:{addItem(e){const t=e.childs[e.childs.length-1],s=Math.max(...e.childs.map(d=>d.order)),n={...e.newTask};n.board_id=t?t.board_id:this.stages[0].board_id,n.stage_id=t?t.stage_id:this.stages[0].id;const o=this.fields.find(d=>d.id==e.attributes.field_id);n.fields=[{field_id:e.attributes.field_id,field_name:o.name,value:e.attributes.name}],n.order=s+1,this.$emit("saved",{...n},!0),e.newTask={}},changeStatus(e,t){if(e.added){let s=e.added.element.fields.find(n=>n.field_id==t.attributes.field_id);s?this.$set(s,"value",t.attributes.name):(s=this.fields.find(n=>n.id==t.attributes.field_id),e.added.element.fields.push({field_id:s.id,field_name:s.name,value:t.attributes.name})),this.$emit("saved",e.added.element)}}}},P=e=>(L("data-v-7e4fa9c2"),e=e(),U(),e),ct={class:"flex notes-container"},mt={class:"w-full mx-2"},ut={class:"flex items-center justify-between w-full h-12 font-bold capitalize header"},ft=P(()=>i("span",null," Notes ",-1)),_t={class:"ml-4 text-gray-300"},ht=P(()=>i("div",{class:"flex justify-center w-5 h-full py-2 text-center rounded-full hover:bg-gray-200"},[i("div",{class:"flex items-center mr-2"},[i("i",{class:"fa fa-ellipsis-v"})])],-1)),pt=v("Edit"),vt=v("Delete"),bt={class:"pt-5 pr-4"},gt={class:"checkbox-label"},yt=P(()=>i("span",{class:"font-bold"},null,-1)),wt={class:"font-bold"},xt=["innerHTML"];function kt(e,t,s,n,o,d){const h=u("el-dropdown-item"),p=u("el-dropdown-menu"),y=u("el-dropdown"),w=u("draggable");return l(),r("div",ct,[i("div",mt,[i("div",ut,[i("div",null,[ft,i("span",_t,g(s.kanbanData.backlog.childs.length),1)]),m(y,{trigger:"click",onClick:t[0]||(t[0]=V(()=>{},["prevent"]))},{default:f(()=>[ht,m(p,{slot:"dropdown"},{default:f(()=>[m(h,{command:"edit",icon:"fa fa-edit"},{default:f(()=>[pt]),_:1}),m(h,{command:"delete",icon:"fa fa-trash"},{default:f(()=>[vt]),_:1})]),_:1})]),_:1})]),i("div",bt,[m(w,{class:"grid grid-cols-6 gap-4",list:s.kanbanData.backlog.childs,group:"tasks",onChange:t[1]||(t[1]=_=>d.changeStatus(_,e.quadrant))},{default:f(()=>[(l(!0),r(k,null,S(s.kanbanData.backlog.childs,_=>(l(),r("div",{key:`task-${_.id}`,class:I(`task-item p-5 bg-${_.color}-300`)},[i("label",gt,[yt,i("span",wt,g(_.title),1)]),i("div",{innerHTML:_.snippet,class:"note-body"},null,8,xt)],2))),128))]),_:1},8,["list"])])])])}var B=O(rt,[["render",kt],["__scopeId","data-v-7e4fa9c2"]]);const St={name:"Board",components:{ListView:Qe,KanbanView:at,NoteView:B,HabiticaView:B,MatrixView:B,ItemModal:H,AutomationModal:W,Draggable:A,BulkSelectionBar:X},provide(){return{users:this.users}},props:{board:{type:Object,required:!0},automations:{type:Array,required:!0},users:{type:Array,required:!0},filters:{type:Object,default(){return{search:"",done:""}}}},data(){return{createMode:!1,modeSelected:"list",views:{list:{name:"list",title:"List",component:"ListView",icon:"fa fa-th-list"},kanban:{name:"kanban",title:"Kanban",component:"KanbanView",icon:"fa fa-border-all"},notes:{name:"notes",title:"Notes",component:"NoteView",icon:"fa fa-border-all"},habitica:{name:"habitica",title:"Habitica",component:"HabiticaView",icon:"fa fa-border-all"},matrix:{name:"matrix",title:"Matrix",component:"MatrixView",icon:"fa fa-border-all"}},itemToDelete:!1,items:[{title:"Test",owner:"Jesus Guerrero",status:"todo",due_date:new Date().toISOString().slice(0,10),priority:"High"},{title:"Test",owner:"Jesus Guerrero",status:"todo",due_date:new Date().toISOString().slice(0,10),priority:"low"},{title:"Test",owner:"Jesus Guerrero",status:"todo",due_date:new Date().toISOString().slice(0,10),priority:"medium"}],comments:[],contacts:[{name:"Jesus Guerrero"}],searchOptions:{search:this.filters.search,done:this.filters.done},openedItem:{},isEditMode:!1,isItemModalOpen:!1,isAutomationModalOpen:!1}},watch:{searchOptions:{handler:Y.exports.throttle(function(){let e=this.pickBy(this.searchOptions);e=Object.keys(e).length?"?"+new URLSearchParams(this.pickBy(this.searchOptions)):"",this.$inertia.replace(`/boards/${this.board.id}${e}`)},200),deep:!0,immediate:!0}},computed:{containerComponent(){return this.views[this.modeSelected].component},kanbanData(){if(this.board.stages.length){const e=this.board.fields.find(s=>s.name=="status"),t={};return this.board.labels.forEach(s=>{s.field_id==e.id&&(t[s.name]={id:s.id,fieldId:s.field_id,attributes:s,childs:[],newTask:{}})}),this.board.stages.forEach(s=>{s.items.forEach(n=>{const o=n.fields.find(d=>d.field_name=="status");o&&t[o.value]?t[o.value].childs.push(n):t.backlog.childs.push(n)})}),t}return{}},viewsKeys(){return Object.values(this.views).map(e=>e.name)},selectedItems(){return this.board.stages.reduce((e,t)=>(e.push(...t.items.filter(s=>s.selected)),e),[])}},mounted(){window.document.onscroll=function(){requestAnimationFrame(()=>{e()})};function e(){document.querySelectorAll(".ic-list").forEach((s,n)=>{const o=s.querySelectorAll(".false-header");window.pageYOffset>=s.offsetTop-60&&window.pageYOffset<=s.offsetTop+s.offsetHeight-157?s.querySelectorAll(".sticky_header").forEach(d=>{d.classList.add("sticky-active"),o.forEach(h=>h.classList.add("active")),d.style.transform=`translate3d(0px, ${window.pageYOffset-s.offsetTop+60}px, 1px)`}):s.querySelectorAll(".sticky_header").forEach(d=>{d.classList.remove("sticky-active"),o.forEach(h=>h.classList.remove("active")),d.style.transform=""})})}},methods:{addItem(e,t=!0){const s=e.id?"PUT":"POST",n=e.id?`/${e.id}`:"";axios({url:`/items${n}`,method:s,data:e}).then(()=>{t&&this.$inertia.reload({preserveScroll:!0})})},addStage(e={},t=!0){const s=e.id?"PUT":"POST",n=e.id?`/${e.id}`:"";return e.board_id=this.board.id,e.name=e.name||`Stage ${this.board.stages.length+1}`,axios({url:`/api/stages${n}`,method:s,data:e}).then(({data:o})=>{t&&this.$inertia.reload({preserveScroll:!0})})},updateBoardName(e={},t=!0){const s=e.id?"PUT":"POST",n=e.id?`/${e.id}`:"";return axios({url:`/api/boards${n}`,method:s,data:{name:e.name}}).then(({data:o})=>{t&&(this.$inertia.reload({preserveScroll:!0}),this.isEditMode=!1)})},addStage(e={},t=!0){const s=e.id?"PUT":"POST",n=e.id?`/${e.id}`:"";return e.board_id=this.board.id,e.name=e.name||`Stage ${this.board.stages.length+1}`,axios({url:`/api/stages${n}`,method:s,data:e}).then(({data:o})=>{t&&this.$inertia.reload({preserveScroll:!0})})},runAutomation(e){return axios({url:`/api/automations/${e}/run`,method:"POST"}).then(({data:t})=>{this.$notify({type:"success",title:"Automation sync",message:"Updated"}),this.$inertia.reload({preserveScroll:!0})})},saveReorder(){this.board.stages.forEach(async(e,t)=>{e.order=t,await this.addStage(e,!1)}),this.$inertia.reload({preserveScroll:!0})},toggleDone(){const e={with:"only",only:"","":"with"};this.searchOptions.done=e[this.searchOptions.done]},pickBy(e,t){const s={};return Object.entries(this.searchOptions).map(([n,o])=>{o&&(s[n]=o)}),s},openItem(e){this.isItemModalOpen=!0,this.openedItem=e},confirmDeleteItem(e,t=!0){this.showConfirm({title:`Deleting ${e.title} task`,content:"Are you sure you want to delete this tasks?",confirmationButtonText:"Yes, delete",confirm:()=>{axios({url:`/items/${e.id}`,method:"delete"}).then(()=>{t&&(this.itemToDelete=!1,this.$inertia.reload({preserveScroll:!0}))})}})},confirmDeleteItems(e,t=!0){this.showConfirm({title:`Deleting ${e.length} tasks`,content:"Are you sure you want to delete these tasks?",confirmationButtonText:"Yes, delete",confirm:()=>{axios({url:"/api/items/bulk/delete",method:"post",data:e.map(s=>s.id)}).then(()=>{this.$inertia.reload({preserveScroll:!0})})}})},toggleEditMode(){this.isEditMode=!this.isEditMode,this.$nextTick(()=>{this.$refs.input&&this.$refs.input.focus()})}}},It={class:"px-8 pb-24"},$t={class:"flex justify-between board__toolbar"},Ct={class:"flex text-left"},Et={class:"flex justify-between mr-2"},Ot={key:0,class:"text-3xl font-bold"},Mt={key:1},Tt=["onClick"],Vt=["src"],Dt={key:1},At={class:"flex items-center"},jt={class:"w-40"},Bt={slot:"singleLabel","slot-scope":"props"},Ft={class:"option__title"},Lt={slot:"option","slot-scope":"props"},Ut={class:"option__desc"},Pt={class:"option__title"},Kt=i("i",{class:"fa fa-eye"},null,-1),Nt=[Kt],zt={class:""},Gt={key:2,class:"flex justify-center w-full py-5"},Ht=i("i",{class:"fa fa-plus"},null,-1),Rt=[Ht];function Yt(e,t,s,n,o,d){const h=u("multiselect"),p=u("bulk-selection-bar"),y=u("list-view"),w=u("draggable"),_=u("item-modal"),b=u("automation-modal");return l(),r("div",It,[i("div",$t,[i("div",Ct,[i("div",Et,[o.isEditMode?(l(),r("div",Mt,[E(i("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>s.board.name=c),type:"text",ref:"input",onKeypress:t[1]||(t[1]=T(c=>d.updateBoardName(s.board),["enter"]))},null,544),[[F,s.board.name]])])):(l(),r("span",Ot,g(s.board.name),1)),i("i",{class:"mx-2 fa fa-edit",onClick:t[2]||(t[2]=c=>d.toggleEditMode(!0))}),i("div",null,[(l(!0),r(k,null,S(s.automations,c=>(l(),r("span",{class:"automation",key:`automation-${c.id}`,onClick:a=>d.runAutomation(c.id)},[c.service_logo?(l(),r("img",{key:0,src:c.service_logo,class:"automation-logo"},null,8,Vt)):(l(),r("div",Dt,g(c.name[0]),1))],8,Tt))),128))])])]),i("div",At,[i("div",jt,[m(h,{modelValue:o.modeSelected,"onUpdate:modelValue":t[3]||(t[3]=c=>o.modeSelected=c),ref:"input","show-labels":!1,options:d.viewsKeys,class:"w-full"},{default:f(()=>[i("template",Bt,[i("span",Ft,[i("i",{class:I([o.views[e.props.option].icon,"mr-2"])},null,2),v(" "+g(o.views[e.props.option].title),1)])]),i("template",Lt,[i("div",Ut,[i("span",Pt,[i("i",{class:I([o.views[e.props.option].icon,"mr-2"])},null,2),v(" "+g(o.views[e.props.option].title),1)])])])]),_:1},8,["modelValue","options"])]),E(i("input",{type:"search",class:"w-48 ml-2 form-input",name:"",id:"","onUpdate:modelValue":t[4]||(t[4]=c=>o.searchOptions.search=c),placeholder:"search"},null,512),[[F,o.searchOptions.search]]),i("span",{class:I(["ml-2 toolbar-buttons",{active:o.searchOptions.done}]),onClick:t[5]||(t[5]=c=>d.toggleDone())},Nt,2)])]),d.selectedItems.length?(l(),$(p,{key:0,"selected-items":d.selectedItems,onDeletePressed:t[6]||(t[6]=c=>d.confirmDeleteItems(d.selectedItems,!0))},null,8,["selected-items"])):x("",!0),i("div",zt,[o.modeSelected=="list"?(l(),$(w,{key:0,modelValue:s.board.stages,"onUpdate:modelValue":t[7]||(t[7]=c=>s.board.stages=c),handle:".handle",onEnd:d.saveReorder},{default:f(()=>[m(J,null,{default:f(()=>[(l(!0),r(k,null,S(s.board.stages,c=>(l(),$(y,{key:c.name,stage:c,board:s.board,items:c.items,"create-mode":o.createMode,onSaved:d.addItem,onOpenItem:d.openItem,onItemDeleted:d.confirmDeleteItem,onStageUpdated:d.addStage,class:"mt-10"},null,8,["stage","board","items","create-mode","onSaved","onOpenItem","onItemDeleted","onStageUpdated"]))),128))]),_:1})]),_:1},8,["modelValue","onEnd"])):(l(),$(Q(d.containerComponent),{key:1,stages:s.board.stages,fields:s.board.fields,"kanban-data":d.kanbanData,onSaved:d.addItem,class:"flex pt-5"},null,40,["stages","fields","kanban-data","onSaved"])),o.modeSelected=="list"?(l(),r("div",Gt,[i("button",{class:"flex items-center justify-center w-8 h-8 px-2 text-purple-400 border-2 border-purple-400 rounded-full hover:bg-purple-400 hover:text-white",onClick:t[8]||(t[8]=c=>d.addStage())},Rt)])):x("",!0)]),m(_,{onCancel:t[9]||(t[9]=c=>o.isItemModalOpen=!1),onSaved:t[10]||(t[10]=c=>o.isItemModalOpen=!1),"record-data":o.openedItem,"is-open":o.isItemModalOpen},null,8,["record-data","is-open"]),m(b,{onCancel:t[11]||(t[11]=c=>o.isAutomationModalOpen=!1),onSaved:t[12]||(t[12]=c=>o.isAutomationModalOpen=!1),"record-data":{},board:s.board,"is-open":o.isAutomationModalOpen},null,8,["board","is-open"])])}var Jt=O(St,[["render",Yt]]);const Qt={components:{AppLayout:z,BoardSection:Jt,BoardSide:G},props:{boards:{type:Array,default(){return[]}},board:{type:Object,default(){return{}}},automations:{type:Array,refault(){return[]}},users:{type:Array,refault(){return[]}}}},Wt={class:""},Xt={class:"pt-12 mx-2 w-12/12"},Zt={class:"overflow-hidden"};function qt(e,t,s,n,o,d){const h=u("board-section"),p=u("app-layout");return l(),$(p,{boards:s.boards},{default:f(()=>[i("div",Wt,[i("div",Xt,[i("div",Zt,[m(h,{board:s.board,users:s.users,automations:s.automations},null,8,["board","users","automations"])])])])]),_:1},8,["boards"])}var _s=O(Qt,[["render",qt]]);export{_s as default};
