import{J as b}from"./DialogModal.7ab1b676.js";import{J as v}from"./Button.2e6d22da.js";import{k as _,o as m,a as y,w as n,b as o,j as l,g as d,t as f,d as c,q as u,i as w,m as V,l as C}from"./app.3ce0088d.js";import{_ as I}from"./plugin-vue_export-helper.21dcd24c.js";const S={components:{DialogModal:b,PrimaryButton:v},props:{isOpen:{type:Boolean},recordData:{type:Object},type:{type:String},boards:{type:Array}},data(){return{isLoading:!1,formData:{service:null,recipe:null},newCheck:{},services:[],recipies:[],integrations:[],calendarList:[],emailConditions:[{id:"from:",name:"From"},{name:"To",id:"to:"},{name:"subject:",id:"Subject"},{name:"Includes",id:"has"},{id:"",name:"Custom"}]}},created(){this.getServices(),this.getIntegrations(),this.getRecipies(),this.getCalendarList()},watch:{recordData(){this.formData=this.recordData}},computed:{visibleFields(){return this.formData.board&&this.formData.board.fields?this.formData.board.fields.map(t=>(t.order=this.fieldOrder.findIndex(e=>t.name==e),t)).filter(t=>!t.hide).sort((t,e)=>t.order-e.order):[]},fieldOrder(){return{event:["owner","status","priority","date","time","due_date","end_time"]}[this.type]||[]},typeFields(){return{event:[{name:"date",type:"date",title:"Date"},{name:"time",type:"time",title:"Time"},{name:"due_date",type:"date",title:"Due Date"},{name:"end_time",type:"time",title:"End Time"}]}[this.type]||[]},automationRecipies(){return this.formData.service?this.recipies.filter(t=>t.automation_service_id==this.formData.service.id):[]},serviceIntegrations(){return this.formData.service?this.integrations.filter(t=>t.automation_service_id==this.formData.service.id):[]}},methods:{prepareForm(){const t={...this.formData};t.automation_recipe_id=this.formData.recipe.id,t.name=this.formData.recipe.name,t.description=this.formData.recipe.name,t.sentence=this.formData.recipe.name,t.config={},this.formData.integration&&(t.integration_id=this.formData.integration.id),this.formData.board&&(t.board_id=this.formData.board.id),this.formData.stage&&(t.config.stage_id=this.formData.stage.id),this.formData.Condition&&(t.config.condition=this.formData.Condition.id);const e=this.getInputs();return e&&e.map(a=>{t.config[a]||(t.config[a]=t[a])}),t.config=JSON.stringify(t.config),delete t.board,delete t.stage,t},save(){const t=this.formData.id?"PUT":"POST",e=this.formData.id?`/${this.formData.id}`:"",a=this.prepareForm();if(!a.board_id){this.$notify({type:"info",message:"Board and title are required"});return}axios({url:`/api/automations${e}`,method:t,data:a}).then(()=>{this.$emit("saved")})},getBoardData(){this.isLoading=!0,Promise.all([axios({url:"/api/stages/",params:{"filter[board_id]":this.formData.board.id}}),axios({url:"/api/fields",params:{"filter[board_id]":this.formData.board.id}})]).then(([t,e])=>{let a=e.data.data;const h=t.data.data;this.$set(this.formData.board,"stages",h),this.$set(this.formData,"stage",h[0]);const s=a.map(r=>r.name);this.typeFields.forEach(r=>{s.includes(r.name)||a.push(r)}),this.$set(this.formData.board,"fields",a),this.isLoading=!1})},getServices(){axios({url:"/api/automation-services"}).then(({data:t})=>{this.services=t})},getIntegrations(){axios({url:"/api/integrations"}).then(({data:t})=>{this.integrations=t.data})},getRecipies(){axios({url:"/api/automation-recipies"}).then(({data:t})=>{this.recipies=t})},getCalendarList(){axios({url:"/api/calendars"}).then(({data:t})=>{this.calendarList=t})},getInputs(){if(this.formData.recipe){const t=JSON.parse(this.formData.recipe.mapper);return t&&t.input}},hasInput(t){const e=this.getInputs();if(e)return e.includes(t)}}},k=o("span",{class:"text-lg"}," Add Automation ",-1),B={class:"form-group"},L=o("label",{for:"title"}," Service ",-1),x={slot:"singleLabel","slot-scope":"props"},O=["src"],U={slot:"option","slot-scope":"props"},T={class:"d-flex"},A=["src"],F={key:0,class:"form-group"},J=o("label",{for:"title"}," Connection ",-1),M={key:1,class:"form-group"},N=o("label",{for:"title"}," Recipe ",-1),R={key:2,class:"form-group"},j=o("label",{for:"title"}," Board ",-1),P={slot:"singleLabel","slot-scope":"props"},E={class:"option__title"},q=o("i",{class:"mr-2 fa fa-briefcase"},null,-1),z={slot:"option","slot-scope":"props"},G={class:"option__desc"},H={class:"option__title"},K=o("i",{class:"mr-2 fa fa-briefcase"},null,-1),Q={key:3,class:"form-group"},W=o("label",{for:"title"}," Stage ",-1),X={slot:"singleLabel","slot-scope":"props"},Y={class:"option__title"},Z=o("i",{class:"mr-2 fa fa-briefcase"},null,-1),$={slot:"option","slot-scope":"props"},tt={class:"option__desc"},et={class:"option__title"},ot=o("i",{class:"mr-2 fa fa-briefcase"},null,-1),st={key:4,class:"form-group"},it=o("label",{for:"title"}," Condition ",-1),at={key:5,class:"form-group"},rt=o("label",{for:"title"}," value ",-1),nt=d(" Cancel "),lt=d(" Save ");function dt(t,e,a,h,s,r){const p=_("multiselect"),g=_("primary-button"),D=_("dialog-modal");return m(),y(D,{show:a.isOpen,onClose:e[10]||(e[10]=i=>t.$emit("closed"))},{title:n(()=>[k]),content:n(()=>[o("form",{action:"",onSubmit:e[7]||(e[7]=C((...i)=>r.save&&r.save(...i),["prevent"]))},[o("div",B,[L,l(p,{modelValue:s.formData.service,"onUpdate:modelValue":e[0]||(e[0]=i=>s.formData.service=i),ref:"input","show-labels":!1,options:s.services,class:"w-full"},{default:n(()=>[o("template",x,[o("div",null,[o("img",{src:t.props.option.logo,class:"mr-2 automation-logo"},null,8,O),d(" "+f(t.props.option.name),1)])]),o("template",U,[o("div",T,[o("img",{src:t.props.option.logo,class:"mr-2 automation-logo"},null,8,A),d(" "+f(t.props.option.name),1)])])]),_:1},8,["modelValue","options"])]),r.serviceIntegrations?(m(),c("div",F,[J,l(p,{modelValue:s.formData.integration,"onUpdate:modelValue":e[1]||(e[1]=i=>s.formData.integration=i),ref:"input","show-labels":!1,label:"hash",options:r.serviceIntegrations,class:"w-full"},null,8,["modelValue","options"])])):u("",!0),s.formData.service?(m(),c("div",M,[N,l(p,{modelValue:s.formData.recipe,"onUpdate:modelValue":e[2]||(e[2]=i=>s.formData.recipe=i),ref:"input","show-labels":!1,label:"name",options:r.automationRecipies,class:"w-full"},null,8,["modelValue","options"])])):u("",!0),a.boards?(m(),c("div",R,[j,l(p,{modelValue:s.formData.board,"onUpdate:modelValue":e[3]||(e[3]=i=>s.formData.board=i),ref:"input","show-labels":!1,"allow-empty":!1,placeholder:"Select board",options:a.boards,class:"w-full",onInput:r.getBoardData},{default:n(()=>[o("template",P,[o("span",E,[q,d(" "+f(t.props.option.name),1)])]),o("template",z,[o("div",G,[o("span",H,[K,d(" "+f(t.props.option.name),1)])])])]),_:1},8,["modelValue","options","onInput"])])):u("",!0),s.formData.board&&s.formData.board.stages?(m(),c("div",Q,[W,l(p,{modelValue:s.formData.stage,"onUpdate:modelValue":e[4]||(e[4]=i=>s.formData.stage=i),ref:"input","show-labels":!1,"allow-empty":!1,placeholder:"Select board",options:s.formData.board.stages,class:"w-full"},{default:n(()=>[o("template",X,[o("span",Y,[Z,d(" "+f(t.props.option.name),1)])]),o("template",$,[o("div",tt,[o("span",et,[ot,d(" "+f(t.props.option.name),1)])])])]),_:1},8,["modelValue","options"])])):u("",!0),r.hasInput("condition")?(m(),c("div",st,[it,l(p,{modelValue:s.formData.Condition,"onUpdate:modelValue":e[5]||(e[5]=i=>s.formData.Condition=i),ref:"input","show-labels":!1,label:"name",options:s.emailConditions,class:"w-full"},null,8,["modelValue","options"])])):u("",!0),r.hasInput("value")?(m(),c("div",at,[rt,w(o("input",{"onUpdate:modelValue":e[6]||(e[6]=i=>s.formData.value=i),type:"text",class:"w-full form-control"},null,512),[[V,s.formData.value]])])):u("",!0)],32)]),footer:n(()=>[l(g,{onClick:e[8]||(e[8]=i=>t.$emit("cancel"))},{default:n(()=>[nt]),_:1}),l(g,{onClick:e[9]||(e[9]=i=>r.save())},{default:n(()=>[lt]),_:1})]),_:1},8,["show"])}var ut=I(S,[["render",dt]]);export{ut as A};
